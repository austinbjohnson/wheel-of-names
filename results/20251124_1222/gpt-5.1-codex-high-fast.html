<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Zapier Wheel of Names · GPT-5.1 Codex</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --zap-orange: #FF4F00;
            --zap-orange-soft: #FF7A33;
            --earth: #201515;
            --cream: #FFF3E6;
            --almost-white: #FFFDF9;
            --moss: #1F3121;
            --night: #2B2358;
            --lavender: #C1B7FF;
            --peach: #FFBF6E;
            --bolt: #F6FFDB;
            --sky: #CDE4E1;
            --radius-lg: 32px;
            --radius-md: 18px;
            --shadow-soft: 0 30px 80px rgba(32, 21, 21, 0.18);
            --shadow-card: 0 12px 30px rgba(32, 21, 21, 0.12);
        }

        * {
            box-sizing: border-box;
        }

        body {
            margin: 0;
            min-height: 100vh;
            font-family: "Space Grotesk", "Inter", -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
            background: var(--cream);
            color: var(--earth);
            line-height: 1.5;
        }

        .app-shell {
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        .hero {
            background: linear-gradient(135deg, var(--zap-orange) 0%, var(--zap-orange-soft) 65%, #FF9A57 100%);
            color: var(--almost-white);
            padding: 3.5rem clamp(1.5rem, 4vw, 4.75rem) 2.25rem;
            position: relative;
            overflow: hidden;
            border-bottom-left-radius: 42px;
            border-bottom-right-radius: 42px;
        }

        .hero::after {
            content: "";
            position: absolute;
            inset: 40px auto auto 60%;
            width: 320px;
            height: 320px;
            background: radial-gradient(circle, rgba(255, 253, 249, 0.3) 0%, rgba(255, 253, 249, 0) 70%);
            pointer-events: none;
        }

        .hero-content {
            max-width: 720px;
            position: relative;
            z-index: 1;
        }

        .eyebrow {
            text-transform: uppercase;
            letter-spacing: 0.2em;
            font-size: 0.75rem;
            font-weight: 600;
            opacity: 0.85;
            margin-bottom: 0.75rem;
        }

        h1 {
            font-size: clamp(2.4rem, 4vw, 3.4rem);
            margin: 0 0 1rem;
            line-height: 1.1;
        }

        .lede {
            max-width: 620px;
            font-size: 1.1rem;
            opacity: 0.95;
            margin-bottom: 1.5rem;
        }

        .hero-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 0.75rem;
        }

        .tag {
            border: 1px solid rgba(255, 253, 249, 0.4);
            border-radius: 999px;
            padding: 0.4rem 1rem;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .tag.accent {
            background: var(--almost-white);
            color: var(--zap-orange);
        }

        .metrics {
            margin-top: 2.5rem;
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .metric-card {
            background: rgba(255, 253, 249, 0.18);
            border-radius: var(--radius-md);
            padding: 1rem 1.25rem;
            backdrop-filter: blur(6px);
            min-width: 160px;
        }

        .metric-card span {
            display: block;
            font-size: 0.85rem;
            letter-spacing: 0.08em;
            text-transform: uppercase;
            opacity: 0.85;
            margin-bottom: 0.35rem;
        }

        .metric-card strong {
            font-size: 2rem;
            line-height: 1.1;
        }

        main {
            flex: 1;
            padding: 0 clamp(1.5rem, 4vw, 4.75rem) 4rem;
            margin-top: -90px;
        }

        .layout {
            display: grid;
            grid-template-columns: minmax(0, 1fr) minmax(320px, 400px);
            gap: 2rem;
            align-items: flex-start;
        }

        .panel {
            background: var(--almost-white);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-soft);
            padding: clamp(1.5rem, 3vw, 2.5rem);
            position: relative;
        }

        .panel h2 {
            margin-top: 0;
            font-size: 1.35rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .wheel-canvas-wrapper {
            position: relative;
            width: min(440px, 100%);
            margin: 0 auto;
            aspect-ratio: 1 / 1;
        }

        canvas {
            width: 100%;
            height: 100%;
            display: block;
        }

        .wheel-pointer {
            position: absolute;
            top: -26px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 20px solid transparent;
            border-right: 20px solid transparent;
            border-bottom: 36px solid var(--earth);
            filter: drop-shadow(0 6px 8px rgba(32, 21, 21, 0.3));
        }

        .center-cap {
            position: absolute;
            inset: 50%;
            width: 90px;
            height: 90px;
            border-radius: 50%;
            background: var(--almost-white);
            transform: translate(-50%, -50%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            color: var(--earth);
            border: 4px solid rgba(32, 21, 21, 0.08);
            box-shadow: inset 0 0 12px rgba(32, 21, 21, 0.12);
            pointer-events: none;
        }

        .center-cap span {
            font-size: 0.75rem;
            letter-spacing: 0.1em;
        }

        .control-row {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            margin: 1.5rem 0 0.5rem;
        }

        button {
            font-family: inherit;
            cursor: pointer;
            border: none;
            border-radius: 999px;
            font-size: 1rem;
            font-weight: 600;
            transition: transform 0.2s ease, box-shadow 0.2s ease, background 0.2s ease;
        }

        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .btn-primary {
            background: var(--zap-orange);
            color: var(--almost-white);
            padding: 0.9rem 2.25rem;
            box-shadow: 0 15px 28px rgba(255, 79, 0, 0.35);
        }

        .btn-primary:hover:not(:disabled) {
            transform: translateY(-2px) scale(1.01);
        }

        .btn-ghost {
            background: transparent;
            color: var(--earth);
            padding: 0.9rem 1.25rem;
            border-radius: 999px;
            border: 2px solid rgba(32, 21, 21, 0.12);
        }

        .winner-card {
            margin-top: 1.75rem;
            padding: 1.5rem;
            border-radius: var(--radius-md);
            border: 1px solid rgba(32, 21, 21, 0.08);
            background: linear-gradient(145deg, rgba(255, 79, 0, 0.08), rgba(255, 253, 249, 0.8));
            box-shadow: var(--shadow-card);
        }

        .winner-card p {
            margin: 0 0 0.35rem;
            text-transform: uppercase;
            letter-spacing: 0.15em;
            font-size: 0.75rem;
            color: rgba(32, 21, 21, 0.7);
        }

        .winner-card h3 {
            margin: 0;
            font-size: 1.9rem;
            line-height: 1.2;
        }

        .winner-card span {
            font-size: 0.95rem;
            color: rgba(32, 21, 21, 0.85);
        }

        form {
            margin: 0 0 1.5rem;
        }

        label {
            display: block;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .input-row {
            display: flex;
            gap: 0.65rem;
            flex-wrap: wrap;
        }

        input[type="text"] {
            flex: 1;
            padding: 0.85rem 1rem;
            border-radius: 16px;
            border: 2px solid rgba(32, 21, 21, 0.12);
            background: var(--almost-white);
            font-size: 1rem;
        }

        input[type="text"]:focus {
            outline: none;
            border-color: var(--zap-orange);
            box-shadow: 0 0 0 4px rgba(255, 79, 0, 0.15);
        }

        .helper {
            font-size: 0.85rem;
            color: rgba(32, 21, 21, 0.65);
            margin-top: 0.5rem;
        }

        .list-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .list-header h3 {
            margin: 0;
            font-size: 1rem;
            letter-spacing: 0.12em;
            text-transform: uppercase;
        }

        .bulk-actions {
            display: flex;
            gap: 0.35rem;
        }

        .btn-small {
            padding: 0.4rem 0.8rem;
            font-size: 0.85rem;
            border-radius: 12px;
            border: 1px solid rgba(32, 21, 21, 0.12);
            background: transparent;
        }

        .name-list {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .name-row {
            border: 1px solid rgba(32, 21, 21, 0.08);
            border-radius: var(--radius-md);
            padding: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 1rem;
            background: white;
            transition: border-color 0.2s ease, box-shadow 0.2s ease;
        }

        .name-row.is-disabled {
            opacity: 0.55;
        }

        .name-row.is-highlighted {
            border-color: var(--zap-orange);
            box-shadow: 0 12px 26px rgba(255, 79, 0, 0.25);
        }

        .name-info {
            flex: 1;
        }

        .pill {
            display: inline-flex;
            align-items: center;
            gap: 0.35rem;
            background: rgba(255, 79, 0, 0.12);
            color: var(--earth);
            border-radius: 999px;
            padding: 0.2rem 0.8rem;
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            margin-bottom: 0.35rem;
        }

        .pill.disabled {
            background: rgba(32, 21, 21, 0.08);
        }

        .name-text {
            font-size: 1.1rem;
            font-weight: 600;
        }

        .row-actions {
            display: flex;
            gap: 0.35rem;
            flex-wrap: wrap;
        }

        .row-actions button {
            border-radius: 12px;
            padding: 0.4rem 0.85rem;
            border: 1px solid rgba(32, 21, 21, 0.15);
            background: transparent;
            font-size: 0.85rem;
        }

        .row-actions .danger {
            border-color: rgba(255, 79, 0, 0.4);
            color: var(--zap-orange);
        }

        .empty-state {
            padding: 1.25rem;
            text-align: center;
            border-radius: var(--radius-md);
            border: 1px dashed rgba(32, 21, 21, 0.2);
            color: rgba(32, 21, 21, 0.6);
        }

        .dialog-backdrop {
            position: fixed;
            inset: 0;
            background: rgba(32, 21, 21, 0.65);
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
            padding: 1rem;
        }

        .dialog-backdrop.is-visible {
            opacity: 1;
            pointer-events: auto;
        }

        .dialog-card {
            background: var(--almost-white);
            border-radius: 28px;
            max-width: 420px;
            width: 100%;
            padding: 2rem;
            text-align: center;
            box-shadow: var(--shadow-soft);
            position: relative;
        }

        .dialog-card h3 {
            margin: 0.25rem 0;
            font-size: 2rem;
        }

        .dialog-card p {
            margin: 0.5rem 0 1.5rem;
            color: rgba(32, 21, 21, 0.75);
        }

        .dialog-actions {
            display: flex;
            flex-direction: column;
            gap: 0.7rem;
        }

        .btn-link {
            background: none;
            border: none;
            color: var(--earth);
            text-decoration: underline;
        }

        .app-footer {
            padding: 1.5rem clamp(1.5rem, 4vw, 4.75rem) 3rem;
            text-align: center;
            color: rgba(32, 21, 21, 0.6);
            font-size: 0.9rem;
        }

        @media (max-width: 1100px) {
            .layout {
                grid-template-columns: 1fr;
            }

            .panel {
                padding: 1.5rem;
            }

            main {
                margin-top: -70px;
            }
        }

        @media (max-width: 640px) {
            .control-row {
                flex-direction: column;
            }

            .row-actions {
                width: 100%;
                justify-content: flex-start;
            }

            .row-actions button {
                flex: 1 1 auto;
                text-align: center;
            }

            .metrics {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="app-shell">
        <header class="hero">
            <div class="hero-content">
                <p class="eyebrow">Zapier brand lab</p>
                <h1>Spin the Zapier Wheel of Names</h1>
                <p class="lede">
                    Celebrate teammates, raffle prizes, or pick the next automation hero with a tactile experience that
                    follows the official Zapier brand system. Manage your roster, animate the wheel, and spotlight the winning name in style.
                </p>
                <div class="hero-tags">
                    <span class="tag">Live editing</span>
                    <span class="tag">Confetti-ready</span>
                    <span class="tag accent">Model: GPT-5.1 Codex</span>
                </div>
                <div class="metrics">
                    <div class="metric-card">
                        <span>Active names</span>
                        <strong id="activeCount">0</strong>
                    </div>
                    <div class="metric-card">
                        <span>Disabled</span>
                        <strong id="disabledCount">0</strong>
                    </div>
                    <div class="metric-card">
                        <span>Total roster</span>
                        <strong id="totalCount">0</strong>
                    </div>
                </div>
            </div>
        </header>

        <main>
            <section class="layout">
                <article class="panel wheel-panel">
                    <h2>Interactive wheel</h2>
                    <div class="wheel-canvas-wrapper">
                        <canvas id="wheelCanvas" width="520" height="520"></canvas>
                        <div class="wheel-pointer" aria-hidden="true"></div>
                        <div class="center-cap"><span>Zap</span></div>
                    </div>
                    <div class="control-row">
                        <button id="spinButton" class="btn-primary" type="button">Spin the wheel</button>
                        <button id="enableAll" class="btn-ghost" type="button">Enable everyone</button>
                        <button id="disableAll" class="btn-ghost" type="button">Disable all</button>
                    </div>
                    <div class="winner-card" aria-live="polite" aria-atomic="true">
                        <p>Selected name</p>
                        <h3 id="winnerName">Waiting for a spin</h3>
                        <span id="winnerStatus">Add or enable names to get started.</span>
                    </div>
                </article>

                <article class="panel roster-panel">
                    <h2>Roster management</h2>
                    <form id="entryForm">
                        <label for="entryInput">Add new names</label>
                        <div class="input-row">
                            <input id="entryInput" type="text" name="entry" placeholder="e.g. Zapier Design Team, Marketing, Product Ops">
                            <button class="btn-primary" type="submit">+ Add</button>
                        </div>
                        <p class="helper">Tip: Separate with commas or line breaks to add multiple names at once.</p>
                    </form>

                    <div class="list-header">
                        <h3>Current roster</h3>
                        <div class="bulk-actions">
                            <button class="btn-small" type="button" id="sortAZ">Sort A–Z</button>
                            <button class="btn-small" type="button" id="clearList">Clear all</button>
                        </div>
                    </div>
                    <div id="nameList" class="name-list" aria-live="polite"></div>
                </article>
            </section>
        </main>

        <footer class="app-footer">
            Crafted on November 24, 2025 by GPT-5.1 Codex — tuned for Zapier’s brand palette and Wheel of Names brief.
        </footer>
    </div>

    <div class="dialog-backdrop" id="postSpinDialog" role="dialog" aria-modal="true" aria-hidden="true">
        <div class="dialog-card">
            <p class="eyebrow" style="color: var(--zap-orange); margin-bottom: 0;">Winner</p>
            <h3 id="dialogName">Placeholder</h3>
            <p>Keep this name spinning, or disable it for the next round.</p>
            <div class="dialog-actions">
                <button class="btn-primary" type="button" id="keepName">Keep this name</button>
                <button class="btn-ghost" type="button" id="disableName">Disable this name</button>
                <button class="btn-link" type="button" id="closeDialog">Close</button>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.2/dist/confetti.browser.min.js"></script>
    <script>
        (() => {
            const STORAGE_KEY = "zap-wheel-entries:v1";
            const palette = ["#1F3121", "#2B2358", "#C1B7FF", "#FFBF6E", "#F6FFDB", "#CDE4E1"];
            const wheelCanvas = document.getElementById("wheelCanvas");
            const ctx = wheelCanvas.getContext("2d");
            const entryForm = document.getElementById("entryForm");
            const entryInput = document.getElementById("entryInput");
            const nameList = document.getElementById("nameList");
            const spinButton = document.getElementById("spinButton");
            const enableAllBtn = document.getElementById("enableAll");
            const disableAllBtn = document.getElementById("disableAll");
            const sortBtn = document.getElementById("sortAZ");
            const clearBtn = document.getElementById("clearList");
            const winnerNameEl = document.getElementById("winnerName");
            const winnerStatusEl = document.getElementById("winnerStatus");
            const activeCountEl = document.getElementById("activeCount");
            const disabledCountEl = document.getElementById("disabledCount");
            const totalCountEl = document.getElementById("totalCount");
            const dialog = document.getElementById("postSpinDialog");
            const dialogNameEl = document.getElementById("dialogName");
            const keepBtn = document.getElementById("keepName");
            const disableBtn = document.getElementById("disableName");
            const closeDialogBtn = document.getElementById("closeDialog");

            let entries = loadEntries();
            let rotation = 0;
            let spinning = false;
            let animationFrame;
            let lastWinnerId = null;
            let canvasSize = 420;

            function loadEntries() {
                try {
                    const stored = JSON.parse(localStorage.getItem(STORAGE_KEY));
                    if (Array.isArray(stored) && stored.length) {
                        return stored.map(item => ({
                            id: item.id || crypto.randomUUID(),
                            name: item.name,
                            enabled: item.enabled !== false
                        }));
                    }
                } catch (err) {
                    console.warn("Unable to load saved entries", err);
                }
                return [
                    createEntry("Zapier HQ"),
                    createEntry("Automation Crew"),
                    createEntry("Workflow Wizards"),
                    createEntry("Beta Champions"),
                    createEntry("Product Ops")
                ];
            }

            function createEntry(name, enabled = true) {
                const id = (crypto && crypto.randomUUID) ? crypto.randomUUID() : `entry-${Date.now()}-${Math.random().toString(16).slice(2)}`;
                return { id, name, enabled };
            }

            function persistEntries() {
                localStorage.setItem(STORAGE_KEY, JSON.stringify(entries));
            }

            function getActiveEntries() {
                return entries.filter(entry => entry.enabled);
            }

            function setCanvasSize() {
                const wrapper = document.querySelector(".wheel-canvas-wrapper");
                const wrapperWidth = wrapper.getBoundingClientRect().width;
                canvasSize = Math.max(260, Math.min(wrapperWidth, 460));
                const ratio = window.devicePixelRatio || 1;
                wheelCanvas.width = canvasSize * ratio;
                wheelCanvas.height = canvasSize * ratio;
                wheelCanvas.style.width = canvasSize + "px";
                wheelCanvas.style.height = canvasSize + "px";
                ctx.setTransform(1, 0, 0, 1, 0, 0);
                ctx.scale(ratio, ratio);
                drawWheel(rotation);
            }

            function drawWheel(currentRotation = rotation) {
                const active = getActiveEntries();
                const center = canvasSize / 2;
                const radius = center - 16;

                ctx.clearRect(0, 0, canvasSize, canvasSize);
                ctx.save();
                ctx.translate(center, center);
                ctx.rotate(currentRotation);

                if (!active.length) {
                    ctx.fillStyle = "#FFFDF9";
                    ctx.beginPath();
                    ctx.arc(0, 0, radius, 0, Math.PI * 2);
                    ctx.fill();
                    ctx.setLineDash([10, 14]);
                    ctx.lineWidth = 3;
                    ctx.strokeStyle = "rgba(32,21,21,0.25)";
                    ctx.stroke();
                    ctx.fillStyle = "#201515";
                    ctx.font = "600 18px 'Space Grotesk'";
                    ctx.textAlign = "center";
                    ctx.textBaseline = "middle";
                    ctx.fillText("Add names to spin", 0, 0);
                    ctx.restore();
                    return;
                }

                const sliceAngle = (Math.PI * 2) / active.length;
                const pointerAngle = -Math.PI / 2;
                const startAngleBase = pointerAngle - sliceAngle / 2;
                const fontSize = active.length > 10 ? 12 : active.length > 7 ? 14 : 16;

                active.forEach((entry, index) => {
                    const startAngle = startAngleBase + index * sliceAngle;
                    const endAngle = startAngle + sliceAngle;
                    const sliceColor = palette[index % palette.length];
                    ctx.beginPath();
                    ctx.moveTo(0, 0);
                    ctx.arc(0, 0, radius, startAngle, endAngle);
                    ctx.closePath();
                    ctx.fillStyle = sliceColor;
                    ctx.fill();
                    ctx.strokeStyle = "#FFFDF9";
                    ctx.lineWidth = 4;
                    ctx.stroke();

                    ctx.save();
                    ctx.rotate((startAngle + endAngle) / 2);
                    ctx.translate(radius * 0.62, 0);
                    ctx.rotate(Math.PI / 2);
                    ctx.fillStyle = getTextColor(sliceColor);
                    ctx.font = `600 ${fontSize}px 'Space Grotesk'`;
                    ctx.textAlign = "center";
                    ctx.textBaseline = "middle";
                    wrapText(ctx, entry.name, 0, 0, radius * 0.5, fontSize + 4);
                    ctx.restore();
                });

                ctx.restore();

                ctx.save();
                ctx.translate(center, center);
                ctx.beginPath();
                ctx.fillStyle = "rgba(255,253,249,0.9)";
                ctx.arc(0, 0, radius * 0.2, 0, Math.PI * 2);
                ctx.fill();
                ctx.lineWidth = 3;
                ctx.strokeStyle = "rgba(32,21,21,0.25)";
                ctx.stroke();
                ctx.font = "700 14px 'Space Grotesk'";
                ctx.textAlign = "center";
                ctx.textBaseline = "middle";
                ctx.fillStyle = "#201515";
                ctx.fillText("ZAP", 0, 0);
                ctx.restore();
            }

            function wrapText(context, text, x, y, maxWidth, lineHeight) {
                const words = text.split(" ");
                let line = "";
                const lines = [];

                words.forEach(word => {
                    const attempt = line ? line + " " + word : word;
                    if (context.measureText(attempt).width > maxWidth && line) {
                        lines.push(line);
                        line = word;
                    } else {
                        line = attempt;
                    }
                });
                lines.push(line);

                const totalHeight = (lines.length - 1) * lineHeight;
                lines.forEach((ln, idx) => {
                    context.fillText(ln, x, y - totalHeight / 2 + idx * lineHeight);
                });
            }

            function getTextColor(hex) {
                const raw = hex.replace("#", "");
                const r = parseInt(raw.slice(0, 2), 16);
                const g = parseInt(raw.slice(2, 4), 16);
                const b = parseInt(raw.slice(4, 6), 16);
                const luminance = 0.299 * r + 0.587 * g + 0.114 * b;
                return luminance > 180 ? "#201515" : "#FFFDF9";
            }

            function renderList(highlightId = lastWinnerId) {
                nameList.innerHTML = "";
                if (!entries.length) {
                    nameList.innerHTML = '<div class="empty-state">Start by adding a few teams, prizes, or participants.</div>';
                    return;
                }

                entries.forEach(entry => {
                    const row = document.createElement("div");
                    row.className = "name-row";
                    if (!entry.enabled) row.classList.add("is-disabled");
                    if (highlightId && entry.id === highlightId) row.classList.add("is-highlighted");
                    row.dataset.id = entry.id;
                    row.innerHTML = `
                        <div class="name-info">
                            <span class="pill ${entry.enabled ? "" : "disabled"}">${entry.enabled ? "Active" : "Disabled"}</span>
                            <div class="name-text">${entry.name}</div>
                        </div>
                        <div class="row-actions">
                            <button type="button" data-action="edit">Edit</button>
                            <button type="button" data-action="toggle">${entry.enabled ? "Disable" : "Enable"}</button>
                            <button type="button" data-action="delete" class="danger" aria-label="Remove ${entry.name}">Remove</button>
                        </div>`;
                    nameList.appendChild(row);
                });
            }

            function updateStats() {
                const active = getActiveEntries().length;
                const total = entries.length;
                const disabled = total - active;
                activeCountEl.textContent = active;
                totalCountEl.textContent = total;
                disabledCountEl.textContent = disabled;

                if (!total) {
                    winnerNameEl.textContent = "Your roster is empty";
                    winnerStatusEl.textContent = "Add names to bring the wheel to life.";
                } else if (!active) {
                    winnerNameEl.textContent = "All names are disabled";
                    winnerStatusEl.textContent = "Enable at least one name to spin.";
                } else if (lastWinnerId) {
                    const winner = entries.find(entry => entry.id === lastWinnerId);
                    if (winner) {
                        winnerNameEl.textContent = winner.name;
                        winnerStatusEl.textContent = "Most recent winner";
                    } else {
                        lastWinnerId = null;
                        winnerNameEl.textContent = "Ready to spin";
                        winnerStatusEl.textContent = "Tap the wheel to choose a name.";
                    }
                } else {
                    winnerNameEl.textContent = "Ready to spin";
                    winnerStatusEl.textContent = "Tap the orange button to pick a name.";
                }

                updateSpinButtonState();
            }

            function updateSpinButtonState() {
                const hasActive = getActiveEntries().length > 0;
                spinButton.disabled = !hasActive || spinning;
                spinButton.textContent = spinning ? "Spinning…" : "Spin the wheel";
            }

            function persistAndRefresh() {
                if (lastWinnerId && !entries.some(entry => entry.id === lastWinnerId)) {
                    lastWinnerId = null;
                }
                persistEntries();
                renderList();
                drawWheel();
                updateStats();
            }

            function handleListAction(event) {
                const button = event.target.closest("button[data-action]");
                if (!button) return;
                const row = button.closest(".name-row");
                if (!row) return;
                const id = row.dataset.id;
                const entry = entries.find(item => item.id === id);
                if (!entry) return;

                const action = button.dataset.action;
                if (action === "edit") {
                    const updated = prompt("Edit name", entry.name);
                    if (updated === null) return;
                    const trimmed = updated.trim();
                    if (!trimmed) {
                        alert("Name cannot be empty.");
                        return;
                    }
                    entry.name = trimmed;
                } else if (action === "toggle") {
                    entry.enabled = !entry.enabled;
                } else if (action === "delete") {
                    entries = entries.filter(item => item.id !== id);
                }
                persistAndRefresh();
            }

            function addEntriesFromInput(event) {
                event.preventDefault();
                const raw = entryInput.value.trim();
                if (!raw) return;
                const additions = raw.split(/[\n,]+/).map(name => name.trim()).filter(Boolean);
                if (!additions.length) return;
                additions.forEach(name => entries.push(createEntry(name)));
                entryInput.value = "";
                persistAndRefresh();
            }

            function bulkToggle(state) {
                entries.forEach(entry => entry.enabled = state);
                persistAndRefresh();
            }

            function clearEntries() {
                if (!entries.length) return;
                if (confirm("Remove all names from the roster?")) {
                    entries = [];
                    persistAndRefresh();
                }
            }

            function sortEntries() {
                entries.sort((a, b) => a.name.localeCompare(b.name, undefined, { sensitivity: "base" }));
                persistAndRefresh();
            }

            function spinWheel() {
                if (spinning) return;
                const active = getActiveEntries();
                if (!active.length) return;

                spinning = true;
                updateSpinButtonState();
                const startRotation = rotation;
                const randomExtra = Math.random() * Math.PI * 2;
                const laps = 6 + Math.random() * 3;
                const finalRotation = startRotation + laps * Math.PI * 2 + randomExtra;
                const duration = 4600;
                const startTime = performance.now();

                if (animationFrame) cancelAnimationFrame(animationFrame);

                const animate = (now) => {
                    const elapsed = now - startTime;
                    const progress = Math.min(elapsed / duration, 1);
                    const eased = 1 - Math.pow(1 - progress, 3.2);
                    const current = startRotation + (finalRotation - startRotation) * eased;
                    drawWheel(current);
                    if (progress < 1) {
                        animationFrame = requestAnimationFrame(animate);
                    } else {
                        rotation = finalRotation % (Math.PI * 2);
                        spinning = false;
                        drawWheel(rotation);
                        updateSpinButtonState();
                        finalizeSpin();
                    }
                };

                animationFrame = requestAnimationFrame(animate);
            }

            function finalizeSpin() {
                const result = determineWinner();
                if (!result) return;
                lastWinnerId = result.entry.id;
                winnerNameEl.textContent = result.entry.name;
                winnerStatusEl.textContent = "Just selected";
                renderList(lastWinnerId);
                persistEntries();
                launchConfetti();
                openDialog(result.entry);
            }

            function determineWinner() {
                const active = getActiveEntries();
                if (!active.length) return null;
                const sliceAngle = (Math.PI * 2) / active.length;
                const pointerAngle = -Math.PI / 2;
                const initialAngle = pointerAngle - sliceAngle / 2;
                const normalizedRotation = ((rotation % (Math.PI * 2)) + Math.PI * 2) % (Math.PI * 2);
                let localPointer = pointerAngle - normalizedRotation;
                localPointer = ((localPointer % (Math.PI * 2)) + Math.PI * 2) % (Math.PI * 2);
                let relative = localPointer - initialAngle;
                if (relative < 0) relative += Math.PI * 2;
                let index = Math.floor(relative / sliceAngle);
                if (index >= active.length) index = active.length - 1;
                return { entry: active[index], index };
            }

            function launchConfetti() {
                if (typeof confetti !== "function") return;
                confetti({
                    particleCount: 120,
                    spread: 65,
                    origin: { y: 0.3 },
                    colors: [ "#FF4F00", "#FFFDF9", "#1F3121", "#C1B7FF" ]
                });
                setTimeout(() => {
                    confetti({
                        particleCount: 90,
                        spread: 90,
                        decay: 0.92,
                        origin: { y: 0.45 }
                    });
                }, 220);
            }

            function openDialog(entry) {
                dialog.dataset.activeId = entry.id;
                dialogNameEl.textContent = entry.name;
                dialog.classList.add("is-visible");
                dialog.setAttribute("aria-hidden", "false");
            }

            function closeDialog() {
                dialog.classList.remove("is-visible");
                dialog.setAttribute("aria-hidden", "true");
            }

            function disableFromDialog() {
                const id = dialog.dataset.activeId;
                const entry = entries.find(item => item.id === id);
                if (entry) {
                    entry.enabled = false;
                    persistAndRefresh();
                }
                closeDialog();
            }

            function init() {
                setCanvasSize();
                renderList();
                updateStats();

                entryForm.addEventListener("submit", addEntriesFromInput);
                nameList.addEventListener("click", handleListAction);
                enableAllBtn.addEventListener("click", () => bulkToggle(true));
                disableAllBtn.addEventListener("click", () => bulkToggle(false));
                sortBtn.addEventListener("click", sortEntries);
                clearBtn.addEventListener("click", clearEntries);
                spinButton.addEventListener("click", spinWheel);
                keepBtn.addEventListener("click", closeDialog);
                disableBtn.addEventListener("click", disableFromDialog);
                closeDialogBtn.addEventListener("click", closeDialog);
                dialog.addEventListener("click", (event) => {
                    if (event.target === dialog) {
                        closeDialog();
                    }
                });
                window.addEventListener("resize", () => {
                    window.requestAnimationFrame(setCanvasSize);
                });
            }

            init();
        })();
    </script>
</body>
</html>

